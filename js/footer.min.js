document.addEventListener('DOMContentLoaded', async () => {
	await loadRecentBlogs();
});
async function loadRecentBlogs() {
	try {
		const API = window.API;
		if (!API) {
			console.error('API not available in footer');
			return;
		}
		const blogApi = API.blogAPI || API.blog;
		if (!blogApi) {
			console.error('Blog API not available');
			return;
		}
		const response = await blogApi.getAll();
		if (response && (Array.isArray(response) || response.data)) {
			const blogsData = Array.isArray(response) ? response : response.data;
			const recentBlogs = blogsData.slice(0, 3);
			const blogContainer = document.getElementById('recent-blog-posts');
			if (blogContainer) {
				blogContainer.innerHTML = '';
				recentBlogs.forEach((blog) => {
					let imageUrl;
					const API_BASE_URL =
						window.API_BASE_URL || 'https://buyesi.onrender.com/api';
					if (blog.image) {
						if (blog.image.includes('cloudinary.com')) {
							imageUrl = blog.image;
						} else if (blog.image.startsWith('http')) {
							imageUrl = blog.image;
						} else if (blog.image.includes('/uploads/')) {
							imageUrl = `${API_BASE_URL}${blog.image}`;
						} else {
							imageUrl = `${API_BASE_URL}/uploads/blog/${blog.image}`;
						}
					} else {
						imageUrl = 'images/blog-default.jpg';
					}
					const blogElement = document.createElement('div');
					blogElement.className = 'block-21 mb-4 d-flex';
					blogElement.innerHTML = `
						<a class="blog-img mr-4" style="background-image: url(${imageUrl});"></a>
						<div class="text">
							<h3 class="heading"><a href="blog-single.html?id=${blog._id}">${
						blog.title
					}</a></h3>
							<div class="meta">
								<div><a href="#"><span class="icon-calendar"></span> ${new Date(
									blog.createdAt
								).toLocaleDateString()}</a></div>
								<div><a href="#"><span class="icon-person"></span> ${
									blog.author?.name || blog.author || 'Admin'
								}</a></div>
								<div><a href="#"><span class="icon-chat"></span> ${
									blog.comments?.length || 0
								}</a></div>
							</div>
						</div>
					`;
					blogContainer.appendChild(blogElement);
				});
			}
		} else {
			throw new Error('No blogs data available');
		}
	} catch (error) {
		console.error('Failed to load blogs for footer:', error);
		const blogContainer = document.getElementById('recent-blog-posts');
		if (blogContainer) {
			blogContainer.innerHTML =
				'<p class="text-muted">Unable to load recent blog posts.</p>';
		}
	}
}
